<html>
    <head>
            <title>Flexbox Test</title>
            <link rel= "stylesheet" type= "text/css" href= "/static/css/flex.css">
            <script type="text/javascript" src="/static/js/jquery-3.3.1.min.js"></script>
            <script type="text/javascript" src="/static/js/jquery-ui-1.12.1/jquery-ui.js"></script>
            <script type="text/javascript" src="/static/js/timepicker/jquery.timepicker.js"></script>
            <script type="text/javascript" src="/static/js/timepicker/lib/bootstrap-datepicker.js"></script>
            <script type="text/javascript" src="/static/js/jquery.serialize-object.min.js"></script>
            <link rel= "stylesheet" type= "text/css" href= "/static/js/timepicker/jquery.timepicker.css">
            <link rel= "stylesheet" type= "text/css" href= "/static/js/timepicker/lib/bootstrap-datepicker.css">
            <link rel="stylesheet" type="text/css" href="/static/css/content_zone_manager.css?id=1">
            <link rel="stylesheet" type="text/css" href="/static/css/checkbox.css">
            <link rel="stylesheet" type="text/css" href="/static/css/button.css">
            <script>
               String.prototype.replaceAll = function(search, replacement) {
                    var target = this;
                    return target.replace(new RegExp(search, 'g'), replacement);
                };

                $(document).ready(function(){
                    
                    scheduleCounter = 0;
                    currentlyShowingPanel = $("#content_manager")

                    $("createzone").load("/static/screens/portal/create_zone_include.html");
                    $("zonecards").load("/static/screens/portal/dashboard_include.html");


                    $("#nav_create_zone").click(function(){
                        // hide the others
                        $("zonecards").hide()
                        $("createzone").show()

                    });

                    

                    $(function(){
                        
                        $("#content_dashboard").hide() 
                        $("zonecards").hide()
                        $("createzone").show()

                        // Load teh schedule section
                        $.get("/static/screens/portal/schedule_template_include.html", function(data){
                            // alert(data);
                            var data2 = data.replaceAll("NUMBER_HOLDER", scheduleCounter)
                            $("#schedule_area").append(data2);
                            scheduleCounter++
                        });
                        
                    });

                    $('body').on('click', '#btnAddSchedule', function() {
                        $.get("/static/screens/portal/schedule_template_include.html", function(data){
                            var data2 = data.replaceAll("NUMBER_HOLDER", scheduleCounter)
                            $("#schedule_area").append(data2);
                            scheduleCounter++
                        });
                   });

                   $('body').on('submit', 'form', function(e) {
                        e.preventDefault();
                        // var jsonData = $("#formData").serializeJSON();
                        // console.log(jsonData);


                        // $.ajax({
                        //     url: 'http://127.0.0.1:5000/service_hub/zones/create_zone', // url where to submit the request
                        //     type : "POST", // type of action POST || GET
                        //     dataType : 'json', // data type
                        //     data : jsonData, // post data || get data
                        //     success : function(result) {
                        //         // you can see the result from the console
                        //         // tab of the developer tools
                        //         console.log(result);
                        //     },
                        //     error: function(xhr, resp, text) {
                        //         console.log(text);
                        //     }
                        // });
                    });

                   $('body').on('click', '#btnCreateZone', function() {
                        // e.preventDefault();
                        var jsonData = $("#formData").serializeJSON();
                        console.log(jsonData);


                        $.ajax({
                            url: 'http://127.0.0.1:5000/service_hub/zone', // url where to submit the request
                            type : "POST", // type of action POST || GET
                            dataType : 'json', // data type
                            data : jsonData, // post data || get data
                            success : function(result) {
                                // you can see the result from the console
                                // tab of the developer tools
                                console.log(result);
                            },
                            error: function(xhr, resp, text) {
                                console.log(text);
                            }
                        });
                    });
                  

    

                    $("#nav_view_zone").click(function(){
                        // hide the others
                        $("zonecards").show()
                        $("createzone").hide()

                    });

                    // Logic to show the right panel based on the nav item
                    $(".nav li").click(function() {
                        id = ($(this).attr('id'))
                        
                        //Find the class that's currently showing and toggle it off
                        // $("div.show").hide()
                        $(currentlyShowingPanel).hide()

                        //Find the panel and toggle teh show class
                        panelID = "#" + id.replace("btn", "content")
                        // $(panelID).toggleClass("show")
                        $(panelID).show("puff")
                        currentlyShowingPanel = panelID
                        

                    })

                    var scheduleCounter = 0;

                    // $('.time').timepicker();

                   $('body').on('click', '.time', function() {
                       $(this).timepicker({'step': 10, 'timeFormat': 'H:i'});
                   });
                    

                    //This needs to be done on teh live function in order for dynamically added components to be recognized
                    // $('.delButton').click(function() {
                    //     $(this).parent().remove();
                    // });

                    $('body').on('click', '.delButton', function() {
                        var id  = $(this).attr('id');
                        console.log(id);

                        //If they hit delete on the schedule button, then we need to decrement the counter
                        if(id == "scheduleDelButton")
                        {
                            scheduleCounter--;
                            console.log("Schedule Counter == " + scheduleCounter);
                        }
                        $(this).parent().parent().remove();


                    });
                    

                    


                    $("#formData").submit(function(e){
                        // alert("x");
                        e.preventDefault();
                        alert("y");
                        
                        // var jsonData = $("form#formData").serializeJSON();
                        // console.log(jsonData);


                        // $.ajax({
                        //     url: 'http://127.0.0.1:5000/service_hub/zones/create_zone', // url where to submit the request
                        //     type : "POST", // type of action POST || GET
                        //     dataType : 'json', // data type
                        //     data : jsonData, // post data || get data
                        //     success : function(result) {
                        //         // you can see the result from the console
                        //         // tab of the developer tools
                        //         console.log(result);
                        //     },
                        //     error: function(xhr, resp, text) {
                        //         console.log(text);
                        //     }
                        // });
                    });
                    
                   

                    
                        


                });

                

                


            </script>
    </head>

    <body>
        <div class="flex-container">
            <header>
                <h1 class="title">Lawn Watcher</h1>
                <ul class="nav">
                        <!-- <ul class="nav"> -->
                        <li id="btn_dashboard"><a href="#">Dashboard</a></li>
                        <li class="bar">|</li>
                        <li id="btn_manager"><a href="#" >Zone Manager</a></li>
                        <li class="bar">|</li>
                        <li id="btn_controller"><a href="#">Controller</a></li>
                        <li class="bar">|</li>
                        <li id="btn_logs"><a href="#" >Logs</a></li>
                        <li class="bar">|</li>
                        <li id="btn_settings"><a href="#" >System Settings</a></li>
                        <!-- </ul> -->
                    </ul>
            </header>

            <content>
                <div id="content_dashboard" class="show">Dashboard Content</div>
                
                <!-- manager content -->
                <div id="content_manager">
                    <ul class="sub_nav content_nav">
                        <li id="nav_view_zone"><a href="#">View Zones</a></li>
                        <li id="nav_create_zone"><a href="#">Create Zone</a></li>
                    </ul>
                    <content>

                        <!-- Create Zone content-->
                        <createzone>
                            <!-- see: create_zone_include.html -->
                        </createzone>
                        <zonecards>

                        </zonecards>
                        <!-- View Zones content -->
                        <zonecards>
                            
                           


                        </zonecards>
                    </content>
                </div>


                <div id="content_controller">Controller</div>
            </content>

            <!-- <footer>Sticky footer</footer> -->
        </div>
        
    </body>

</html>